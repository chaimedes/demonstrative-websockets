<!DOCTYPE html>
<title>WebSocket Echo Client</title>
<h2>Websocket Echo Client</h2>
<div id="controls">
    <button id="close">Disconnect</button>
</div>
<div id="output"></div>
<script>
    var ws = null;
    // Initialize WebSocket connection and event handlers
    function setup() {  
        
        var output = document.getElementById("output");  



        try {
            ws = new WebSocket("ws://127.0.0.1:5555");
        }
        catch (security_error_exception) {
            log("The port is currently blocked. Cannot connect.")
        }

        // Listen for the connection open event then call the sendMessage function          
        ws.onopen = function (e) {      
            log("Connected");
            sendMessage("Hello WebSocket!")  
        }

        // Listen for the close connection event
        ws.onclose = function (e) {     
            log("Disconnected: " + (e.reason ? e.reason : e.code));  
        }

        // Listen for connection errors
        ws.onerror = function (e) {      
            log("Encountered an error while attempting to connect. Sorry!");
        }

        // Listen for new messages arriving at the client
        ws.onmessage = function (e) {      
            log("Message received: " + e.data);
            // Close the socket once one message has arrived.      
            //ws.close();  
        }

        document.getElementById("close").onclick = function(e) { disconnect() }
    }

    function disconnect() {
        try {
            ws.close(1000, "Client is disconnecting.");
        }
        catch(exception) {
            log("Failed to close the connection.");
        }
    }

    // Send a message on the WebSocket.
    function sendMessage(msg) { 
        if (ws.readyState == 1) { 
            ws.send(msg);      
            log("Message sent");  
        }
        else {
            log("No open connection; cannot send a message.")
        }
    }

    // Display logging information in the document.
    function log(s) {  
        var p = document.createElement("p");  
        p.style.wordWrap = "break-word";  
        p.textContent = s;  
        output.appendChild(p);          
        console.log(s);
    }

    // Start running the example.
    setup();
</script>